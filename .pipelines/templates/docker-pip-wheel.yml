parameters:
- name: march
  type: string
  default: armv8-a
- name: buildType
  type: string
  default: Debug
- name: buildTesting
  type: string
  default: OFF
- name: enableCoverage
  type: string
  default: OFF
- name: agentBuildDirectory
  type: string
  default: $(Agent.BuildDirectory)
- name: dockerImage
  type: string
  default: ubuntu:22.04
- name: imageTag
  type: string
  default: linux/amd64
- name: pythonVersion
  type: string
  default: 3.11
- name: artifactProject
  type: string
  default: 37e07de7-e7fd-4be8-8379-dc164a4401f3
- name: artifactFeed
  type: string
  default: ""
steps:
- checkout: self
  persistCredentials: true
  path: qdk-chemistry

- task: PipAuthenticate@1
  displayName: Pip Authenticate
  inputs:
    artifactFeeds: ""

- script: |
    echo "Running pip wheel build..."
    docker run --rm \
      --platform ${{ parameters.imageTag }} \
      -v ${{ parameters.agentBuildDirectory }}:/workspace \
      -e QDK_UARCH=${{ parameters.march }} \
      -w /workspace/qdk-chemistry \
      ${{ parameters.dockerImage }} \
    bash .pipelines/pip-scripts/build-pip-wheels.sh ${{ parameters.march }} ${{ parameters.pythonVersion }} ${{ parameters.buildType }} ${{ parameters.buildTesting }} ${{ parameters.enableCoverage }}
  displayName: Build wheel in container
